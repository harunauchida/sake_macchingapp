<%= stylesheet_link_tag "type_diagnostics", media: "all" %>

<div class="diagnosis-result text-center"> 
  <h1>診断結果</h1>
  <p>あなたのタイプは…</p>
  <h2 class="result-type"><%= @type.result %></h2>
</div>

<!-- おすすめの日本酒 -->
<section class="recommended-section text-center">
  <h3 class="section-title">あなたにおすすめの日本酒</h3>

  <div class="sake-card-container">
    <% if @recommended_sakes.present? %>
      <% @recommended_sakes.each do |sake| %>
        <div class="sake-card" id="sake_<%= sake.id %>">
          <% if sake.image_path.present? %>
            <%= image_tag asset_path("sakes/#{sake.image_path}"), alt: sake.name, class: "sake-image" %>
          <% else %>
            <div class="sake-image-placeholder">画像がありません</div>
          <% end %>

          <h3 class="sake-name"><%= sake.name %></h3>
          <p class="sake-description"><%= truncate(sake.description, length: 50) %></p>

          <div class="sake-rating">
            <% if sake.respond_to?(:average_rating) && sake.average_rating.present? %>
              <%= star_rating(sake.average_rating) %>
              <span class="rating-number">(<%= sake.average_rating %>)</span>
            <% else %>
              <span class="rating-number">(0)</span>
            <% end %>
          </div>

          <div class="sake-type-mark">
            <%= case sake.flavor_type
                when "sweet" then "甘口タイプおすすめ 🍯"
                when "medium" then "中口タイプおすすめ 🌾"
                when "dry" then "辛口タイプおすすめ 🔥"
                else "タイプ診断おすすめ 🍶"
                end %>
          </div>

          <%= link_to "レビューを見る", sake_path(sake), class: "btn btn-primary btn-small mt-2" %>

          <div class="sake-favorite-button mt-2">
            <% if logged_in? && !current_user.guest? %>
              <% if current_user.favorited?(sake) %>
                <%= button_to "♥", sake_favorite_path(sake),
                    method: :delete, data: { turbo: false },
                    class: "favorite-btn favorited",
                    aria: { label: "#{sake.name} をお気に入り解除" } %>
              <% else %>
                <%= button_to "♡", sake_favorite_path(sake),
                    method: :post, data: { turbo: false },
                    class: "favorite-btn",
                    aria: { label: "#{sake.name} をお気に入り登録" } %>
              <% end %>
            <% else %>
              <%= button_to "♡", "#",
                  class: "favorite-btn disabled", disabled: true,
                  title: "ゲストユーザーは使用できません" %>
            <% end %>
          </div>
        </div>
      <% end %>
    <% else %>
      <p class="no-sakes mt-2">おすすめの日本酒はまだありません。</p>
    <% end %>
  </div>
</section>

<div class="text-center mt-4">
  <%= link_to "トップに戻る", root_path, class: "btn btn-secondary" %>
</div>
